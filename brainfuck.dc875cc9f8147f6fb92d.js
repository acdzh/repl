(()=>{"use strict";function t(t,n){if(!(t instanceof n))throw new TypeError("Cannot call a class as a function")}function n(t,n){for(var i=0;i<n.length;i++){var e=n[i];e.enumerable=e.enumerable||!1,e.configurable=!0,"value"in e&&(e.writable=!0),Object.defineProperty(t,e.key,e)}}function i(t,i,e){return i&&n(t.prototype,i),e&&n(t,e),t}var e=function(){function n(i,e,r){t(this,n),this.type=i,this.value=e,this.number=r,this.match=-1}return i(n,[{key:"toString",value:function(){return this.value}}]),n}(),r=function n(i){t(this,n);var r=[],u=[],a={">":"increment_pointer","<":"decrement_pointer","+":"increment_data","-":"decrement_data",".":"output",",":"input","[":"jump_forward_if_zero","]":"jump_backward_if_nonzero"},s=0;i.split("").forEach((function(t){if(a[t]){var n=new e(a[t],t,s);if("["===t)u.push(n);else if("]"===t){var i=u.pop();if(!i)throw new Error("Mismatched Brackets.");i.match=n.number,n.match=i.number}r.push(n),s+=1}})),this.tokenized=r},u=function(){var t="Data pointer out of range.";return RangeError?new RangeError(t):new Error(t)},a=function(){},s=function(){function n(i,e,r){t(this,n),this.user_input=i,this.user_output=e,this.result="function"==typeof r?r:a,this.reset()}return i(n,[{key:"reset",value:function(){this.d_ptr=0,this.i_ptr=0,this.data=[]}},{key:"evaluate",value:function(t){this.code=(t instanceof r?t:new r(t)).tokenized,this.i_ptr=0,this.run()}},{key:"run",value:function(){for(var t;"function"!=typeof t;)this.instruction=this.code[this.i_ptr],this.instruction?(t=this[this.instruction.type](),this.i_ptr+=1):t=this.result;t(this.data,this.d_ptr)}},{key:"increment_pointer",value:function(){if(29999===this.d_ptr)throw u;this.d_ptr+=1}},{key:"decrement_pointer",value:function(){if(0===this.d_ptr)throw u;this.d_ptr-=1}},{key:"zerofy",value:function(){void 0===this.data[this.d_ptr]&&(this.data[this.d_ptr]=0)}},{key:"increment_data",value:function(){this.zerofy(),this.data[this.d_ptr]+=1}},{key:"decrement_data",value:function(){this.zerofy(),this.data[this.d_ptr]-=1}},{key:"output",value:function(){this.user_output(String.fromCharCode(this.data[this.d_ptr]))}},{key:"input",value:function(){return function(){var t=this;this.user_input((function(n){var i=n.toString();t.data[t.d_ptr]=i.charCodeAt(0)||10,t.run()}))}.bind(this)}},{key:"jump_forward_if_zero",value:function(){this.data[this.d_ptr]||(this.i_ptr=this.instruction.match)}},{key:"jump_backward_if_nonzero",value:function(){this.data[this.d_ptr]&&(this.i_ptr=this.instruction.match)}}]),n}(),o=function(){function n(i,e,r,u,a,o){t(this,n),this.result=r,this.error=u,this.sandbox=a,this.result_fn_factory=function(t){return function(n,i){var e,r=n.map((function(t){return t}));r.length=r.length<i?i+1:r.length,r.forEach((function(t,n){t||(r[n]=0)})),i<10?e=0:r[e=i-10]="..."+r[e],r[i]||(r[i]=0);var u=r.slice(e,i);r[i+10]&&(r[i+10]+="...");var a=r.slice(i+1,i+10);return t(u.concat(["[".concat(r[i],"]")]).concat(a).join(" "))}},this.result_handler=this.result_fn_factory(this.result),this.BFI=new s(i,e,this.result_handler),o()}return i(n,[{key:"Eval",value:function(t){var n=this;try{if("SHOWTAPE"===t)return this.BFI.result=function(t,i){var e=t.map((function(t){return t}));return e.length=e.length<i?i+1:e.length,e.forEach((function(t,n){t||(e[n]=0)})),e[i]="[".concat(e[i]?0:e[i],"]"),n.result(e.join(" "))},this.BFI.evaluate(""),void(this.BFI.result=this.result_handler);if(t.match(/^RESET\b/))return this.BFI.reset(),void this.BFI.evaluate(t.replace(/^RESET/,""));this.BFI.evaluate(t)}catch(t){this.error(t)}}},{key:"EvalSync",value:function(t){var n=null;return this.BFI.result=this.result_fn_factory((function(t){n=t})),this.BFI.evaluate(t),this.BFI.result=this.result_handler,n}},{key:"GetNextLineIndent",value:function(t){var n=function(t){var n=t.split(""),i=0;return n.forEach((function(t){"["===t?i+=1:"]"===t&&(i-=1)})),i};if(n(t)<=0)return!1;var i=n(t.split("\n").reverse()[0]);return i>0?1:i<0?i:0}}]),n}();("undefined"!=typeof window&&null!==window?window:self).REPLEngine=o})();