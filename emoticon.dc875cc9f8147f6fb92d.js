(()=>{"use strict";function t(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=new Array(e);r<e;r++)n[r]=t[r];return n}function e(e,r){return function(t){if(Array.isArray(t))return t}(e)||function(t,e){var r=t&&("undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"]);if(null!=r){var n,i,s=[],o=!0,u=!1;try{for(r=r.call(t);!(o=(n=r.next()).done)&&(s.push(n.value),!e||s.length!==e);o=!0);}catch(t){u=!0,i=t}finally{try{o||null==r.return||r.return()}finally{if(u)throw i}}return s}}(e,r)||function(e,r){if(e){if("string"==typeof e)return t(e,r);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?t(e,r):void 0}}(e,r)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function r(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function n(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function i(t,e,r){return e&&n(t.prototype,e),r&&n(t,r),t}var s=function(){function t(e,n){if(r(this,t),this.value=e,this.type=n,"emoticon"===this.type){var i=this.value.split("");this.mouth=i.pop(),this.nose=i.pop(),this.face=i.join(""),""===this.face&&(this.face=this.nose,this.nose=null)}}return i(t,[{key:"toString",value:function(){return this.value}}]),t}();function o(t){for(var e,r,n=/^([^\s]+[OC<>\[\]VD@PQ7L#${}\\\/()|3E*])(\s|$)/,i=/^-?\d+/,o=/^[ \t\v]+/,u=/^(\n)/,c=/^\*\*([^*]|\*[^*])*\*\*/,a=/^([^\s]+)\s*/,l=[];t;){var h;(e=t.match(o))||(e=t.match(u))||(e=t.match(c))?e=e[0]:(e=t.match(n))?(e=e[1],r=new s(e,"emoticon"),l.push(r)):(e=t.match(i))?(e=e[0],r=new s(parseInt(e,10).toString(),"data"),l.push(r)):(e=t.match(a))&&(e=e[1],r=new s(e,"data"),l.push(r)),t=t.slice((null===(h=e)||void 0===h?void 0:h.length)||0)}return l}function u(t,e){return(u=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function c(t){return(c="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function a(t,e){return!e||"object"!==c(e)&&"function"!=typeof e?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):e}function l(t){return(l=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function h(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}function f(t,e,r){return(f=h()?Reflect.construct:function(t,e,r){var n=[null];n.push.apply(n,e);var i=new(Function.bind.apply(t,n));return r&&u(i,r.prototype),i}).apply(null,arguments)}function p(t){var e="function"==typeof Map?new Map:void 0;return(p=function(t){if(null===t||(r=t,-1===Function.toString.call(r).indexOf("[native code]")))return t;var r;if("function"!=typeof t)throw new TypeError("Super expression must either be null or a function");if(void 0!==e){if(e.has(t))return e.get(t);e.set(t,n)}function n(){return f(t,arguments,l(this).constructor)}return n.prototype=Object.create(t.prototype,{constructor:{value:n,enumerable:!1,writable:!0,configurable:!0}}),u(n,t)})(t)}var y=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&u(t,e)}(s,t);var e,n,i=(e=s,n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,r=l(e);if(n){var i=l(this).constructor;t=Reflect.construct(r,arguments,i)}else t=r.apply(this,arguments);return a(this,t)});function s(t){var e;return r(this,s),(e=i.call(this)).message=t,e.name="RuntimeError",e}return s}(p(Error)),v=function(){function t(e){r(this,t);var n=e.source,i=e.print,s=e.input,o=e.result,u=e.logger;this.print=i,this.input=s,this.result=o,this.logger=u,n.unshift("START"),this.lists={X:[1],Z:n,A:[":"],G:[],S:[" "],E:[],":":[]}}return i(t,[{key:"debug",value:function(){if(null==this.logger)return!1;this.logger("step ".concat(this.left("X")));var t=Object.entries(this.lists).reduce((function(t,r){var n=e(r,2),i=n[0],s=n[1];return"".concat(t,"\n").concat(i,": ").concat(s.toString())}),"");return this.logger(t),!0}},{key:"closestDivideOrClose",value:function(t){for(var e=this.lists.Z;t<e.length;){if(")"===e[t].mouth)return t;if("|"===e[t].mouth)return this.lists.G[0]="IF",t;t+=1}return 1/0}},{key:"closestCloser",value:function(t){for(var e=this.lists.Z;t<e.length;){if(")"===e[t].mouth)return t;t+=1}return 1/0}},{key:"left",value:function(t){return this.lists[t][0]}},{key:"right",value:function(t){return this.lists[t][this.lists[t].length-1]}},{key:"putRight",value:function(t,e){return this.lists[t].push(e)}},{key:"putLeft",value:function(t,e){return this.lists[t].unshift(e)}},{key:"currentList",value:function(){return this.left("A")}},{key:"clone",value:function(t){return this.lists[t].map((function(t){return t}))}},{key:"run",value:function(){for(var t=!0,e=0;t&&"function"!=typeof t&&e<3e4;)e+=1,this.debug(),t=this.step();return"function"==typeof t?t():"function"==typeof this.result&&this.result(this.lists),this.lists}},{key:"step",value:function(){var t=this.lists.Z[this.left("X")];if(!t)return!1;if(t instanceof s||(t=o(t)[0]),"data"===t.type)this.putRight(this.currentList(),t.value),this.lists.X[0]+=1;else if("emoticon"===t.type){var e=this.execute(t);return this.lists.X[0]+=1,e}return!0}},{key:"execute",value:function(t){var e,r=this,n=t.mouth,i=t.nose,s=t.face,o=function(e,n){if(r.lists[n].length<e)throw new y("List '".concat(n,"' needs to have at least #").concat(e," items to execute ").concat(t," at ").concat(r.left("X")))};s&&1===s.length&&":"===s[0]?e=this.lists[":"]:s&&2===s.length&&":"===s[1]&&s[0]in this.lists?(s=s[0],e=this.lists[s]):this.lists[s]?e=this.lists[s]:(this.lists[s]=[],e=[]);var u=this.currentList(),c=this.lists[u];switch(n){case"O":this.lists.A[0]=s;break;case"C":c.unshift(e.length);break;case"<":o(1,u),this.putLeft(s,c.shift());break;case">":o(1,u),this.putRight(s,c.pop());break;case"[":o(1,u),this.putLeft(s,this.left(u));break;case"]":o(1,u),this.putRight(s,this.right(u));break;case"V":o(2,":");for(var a=this.lists[":"].shift()||0,l=this.lists[":"].shift()||0,h=this.clone(u);h.length;){var f=h.shift(),p=a>0?1:0;a-=1;var v=e.splice(l,p,f);l+=1,p&&this.putRight(":",v[0])}break;case"D":e=this.clone(u),this.lists[s]=e;break;case"@":o(1,u);for(var b=this.left(u);b<=1;b+=1)this.putLeft(s,e.pop());break;case"P":o(1,s),this.print(e[0].toString());break;case"Q":o(1,s),this.print(e.shift().toString());break;case"7":o(1,s);var g=[];e.shift().split("").forEach((function(t){g.push(t)})),e=g.concat(e),this.lists[s]=e;break;case"L":o(1,s);var m=[];e.pop().split("").forEach((function(t){m.push(t)})),this.lists[s]=e.concat(m);break;case"#":var d=this.left(u),k=Number.isNaN(d)?e.splice(0,e.length):e.splice(0,d),w="~"===i?k.join(" "):k.join("");e.unshift(w);break;case"$":var S=this.left(u),E=e.splice(-S,S),R="~"===i?E.join(" "):E.join("");e.push(R);break;case"{":case"}":o(2,s);var O=function(t){return"{"===n?e.unshift(t):e.push(t)},j=function(){return"{"===n?e.shift():e.pop()},_=j(),L=j();switch(i){case"+":O(_+L);break;case"-":O(_-L);break;case"x":O(_*L);break;case"/":O(_/L);break;case"\\":O(_%L)}break;case"\\":case"/":var X=function(t){return"\\"===n?r.lists[":"].unshift(t.toString().toUpperCase()):r.lists[":"].push(t.toString().toUpperCase())},x="\\"===n?this.left(u):this.right(u),A="\\"===n?this.left(s):this.right(s);switch(i){case"=":X(x===A);break;case">":X(x>A);break;case"<":X(x<A);break;case"~":X(x!==A)}break;case"(":this.lists.G.push(this.left("X"));break;case")":var C=this.lists.G.pop(),P="IF"===C?this.left("X"):C-1;this.lists.X[0]=P;break;case"|":this.lists.X[0]=this.closestCloser(this.left("X"));break;case"3":case"E":var T=this.left(":");"TRUE"===T&&(this.lists.X[0]=this.closestDivideOrClose(this.left("X"))),("E"===n&&"TRUE"===T||"FALSE"===T)&&this.lists[":"].shift();break;case"*":return function(){return r.input((function(t){t.split(/[ \t\v]+/).forEach((function(t){r.putRight(u,t)})),r.run()}))}}return!0}}]),t}(),b=function(){function t(n,i,s,o,u,c){r(this,t),this.input=n,this.output=i,this.error=o,this.sandbox=u,this.result_fn_factory=function(t){return function(r){var n=Object.entries(r).map((function(t){var r=e(t,2),n=r[0],i=r[1].toString(),s=i.length-74;return s=s>0?s:0,i=i.slice(s),s>0&&(i="...".concat(i)),"".concat(n,": ").concat(i)})).join("\n");t(n)}},this.result_handler=this.result_fn_factory(s),this.interpreter=new v({source:[],input:this.input,print:this.output,result:this.result_handler}),c()}return i(t,[{key:"Eval",value:function(t){try{t.match(/^RESET\b/)&&(this.interpreter=new v({source:[],input:this.input,print:this.output,result:this.result_handler}),t=t.replace(/^RESET/,""));var e=o(t);this.interpreter.lists.Z=this.interpreter.lists.Z.concat(e),this.interpreter.run()}catch(t){this.error(t)}}},{key:"EvalSync",value:function(t){var e=o(t);this.interpreter.lists.Z=this.interpreter.lists.Z.concat(e);var r="";return this.interpreter.result=this.result_fn_factory((function(t){return r=t})),this.interpreter.run(),this.interpreter.result=this.result_handler,r}},{key:"GetNextLineIndent",value:function(t){var e=function(t){var e=o(t),r=0;return e.forEach((function(t){t.mouth&&("("===t.mouth?r+=1:")"===t.mouth&&(r-=1))})),r};if(e(t)<=0)return 0;var r=e(t.split("\n").slice(-1)[0]);return r>0?1:r<0?r:0}}]),t}();("undefined"!=typeof window&&null!==window?window:self).REPLEngine=b})();